% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lss_sbhm_design.R
\name{lss_sbhm_design}
\alias{lss_sbhm_design}
\title{SBHM Pipeline with fmridesign Models}
\usage{
lss_sbhm_design(
  Y,
  sbhm,
  event_model,
  baseline_model = NULL,
  prewhiten = NULL,
  prepass = list(),
  match = list(shrink = list(tau = 0, ref = NULL, snr = NULL), topK = 1, whiten = TRUE,
    orient_ref = TRUE),
  oasis = list(),
  amplitude = list(method = "global_ls", ridge = list(mode = "fractional", lambda =
    0.02), ridge_frac = list(x = 0.02, b = 0.02), cond_gate = NULL, adaptive =
    list(enable = FALSE, base = 0.02, k0 = 1000, max = 0.08), return_se = FALSE),
  return = c("amplitude", "coefficients", "both"),
  validate = TRUE,
  ...
)
}
\arguments{
\item{Y}{Numeric matrix T×V of fMRI time series (timepoints × voxels).}

\item{sbhm}{SBHM object as returned by `sbhm_build()`.}

\item{event_model}{An `event_model` from `fmridesign::event_model()` defining
the trial structure (typically created with `trialwise()`).}

\item{baseline_model}{Optional `baseline_model` from
`fmridesign::baseline_model()`. Its drift, block, and nuisance terms are
projected out as confounds.}

\item{prewhiten}{Optional prewhitening options (see `?lss`).}

\item{prepass}{Optional list forwarded to `sbhm_prepass()`.}

\item{match}{Optional list forwarded to `sbhm_match()`.}

\item{oasis}{Optional list forwarded to `lss(..., method = "oasis")`. `K`
defaults to `ncol(sbhm$B)`.}

\item{amplitude}{Amplitude options (see `?lss_sbhm`).}

\item{return}{One of `"amplitude"`, `"coefficients"`, or `"both"`.}

\item{validate}{Logical; when TRUE, performs basic checks (sampling frame
compatibility, temporal alignment) analogous to `lss_design()`.}

\item{...}{Reserved for future use.}
}
\value{
Same return contract as `lss_sbhm()`.
}
\description{
Run the SBHM end-to-end pipeline using fmridesign's `event_model` and
optional `baseline_model`, mirroring the convenience of `lss_design()` but
producing SBHM coefficients and (optionally) scalar amplitudes.
}
\details{
This function wraps `lss_sbhm()` by converting the `event_model` into an
OASIS `design_spec` that uses the SBHM basis HRF, and by mapping
`baseline_model` terms to nuisance regressors for projection.
}
\examples{
\dontrun{
  library(fmridesign)
  sframe <- fmrihrf::sampling_frame(blocklens = c(150, 150), TR = 2)
  trials <- data.frame(onset = c(10,30,50, 10,30,50), run = rep(1:2, each=3))
  emod <- event_model(onset ~ trialwise(basis = "spmg1"), data = trials,
                      block = ~run, sampling_frame = sframe)
  # sbhm <- sbhm_build(...)
  Y <- matrix(rnorm(300*100), 300, 100)
  out <- lss_sbhm_design(Y, sbhm, emod)
}

}
